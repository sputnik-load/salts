{% extends "base.html" %}
{% block container %}
  <style>
    .odd {
      background-color: GainsBoro;
    }
  </style>
  <h1>Результаты тестов:</h1>
  <a href="https://wiki.ptnik.su/pages/viewpage.action?pageId=27040006" target="_blank">Справка</a>
  <table id="table"
         data-toggle="table"
         data-url="/get_results/"
         data-height="800"
         data-side-pagination="server"
         data-pagination="true"
         data-page-list="[10, 20, 50, All]"
         data-row-style="row_style"
         data-sort-name="dt_finish"
         data-sort-order="desc"
         data-show-columns="true"
         data-resizable="true"
         data-key-events="true"
         data-ajax="ajax_request"
         data-search="false">
      <thead style="background-color: Bisque">
        <tr>
          <th data-field="id" data-visible="false" title="ID">ID</th>
          <th data-field="test_name" data-sortable="true" data-formatter="test_name_formatter" title="Тест">Тест</th>
          <th data-field="scenario_id" data-sortable="true" data-visible="false" title="ID сценария">Сценарий</th>
          <th data-field="target" data-sortable="true" title="Нагружаемый сервис">Target</th>
          <th data-field="version" data-sortable="true" title="Версия">Версия</th>
          <th data-field="rps" data-sortable="true" title="RPS">RPS</th>
          <th data-field="q99" data-sortable="true" title="99%">99%</th>
          <th data-field="q90" data-sortable="true" title="90%">90%</th>
          <th data-field="q50" data-sortable="true" title="50%">50%</th>
          <th data-field="http_net" title="% ошибок http/net">Ошибки</th>
          <th data-field="duration" data-sortable="true" title="Длительность">Время</th>
          <th data-field="dt_finish" data-sortable="true" title="Время окончания">Окончание</th>
          <th data-field="graph_url" data-formatter="graph_url_formatter" title="График">График</th>
          <th data-field="generator" data-sortable="true" title="Генератор">Генератор</th>
          <th data-field="gen_type_list" data-visible="false" data-sortable="true" title="Тип генератора">Тип</th>
          <th data-field="test_id" data-sortable="true" title="ID теста">ID теста</th>
          <th data-field="ticket_id" data-sortable="true" data-formatter="ticket_id_formatter" title="Задача">Задача</th>
          <th data-field="comment" title="Комментарий">Комментарий</th>
      </tr>
      </thead>
  </table>
{% endblock container %}
{% block scripts_blk %}
  <script>
    var $table = $('#table');

      function edit_page_url(id) {
        return window.location.protocol + "//" + window.location.host + "/admin/salts/testresult/?id=" + id;
      }

      function ajax_request(params) {
        url_param = $.url().param();
        for (name in url_param) {
          if (!params.data.hasOwnProperty(name)) {
            params.data[name] = url_param[name];
          }
        }
        $.ajax(params);        
      }

      function graph_url_formatter(value) {
        if (value === "") {
          return "-";
        }
        return "<a href='" + value + "'>График</a>";
      }

      function ticket_id_formatter(value) {
        if (value === "") {
          return "-";
        }
        return "<a href='https://task.ptnik.su/browse/" + value + "' target='_blank'>" + value + "</a>";
      }

      function test_name_formatter(value, row) {
        if (value === "") {
          return "-";
        }
        return "<a href='" + edit_page_url(row["id"]) + "' target='_blank'>" + value + "</a>";
      }

      function row_style(row, index) {
        if (index % 2 === 0) {
          return {};
        }
        return {classes: "odd"};
      }
      $('#table').bootstrapTable({
        onDblClickRow: function (row, $element) {
          window.open(edit_page_url(row["id"]));
        }
      });
  </script>
{% endblock scripts_blk %}
