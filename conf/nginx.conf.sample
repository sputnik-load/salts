upstream salt-dev-django {
        server unix:///var/run/uwsgi/#HOSTNAME#.sock;
}
upstream salt-dev-django-krylov {
        server unix:///var/run/uwsgi/salts-krylov.sock;
}

server {
	server_name salt-dev, salt-dev.dev.ix.km;
	charset     utf-8;

	client_max_body_size 75M;

	location /media  {
		alias #PROJECT_ROOT#/media;
	}

	location /static  {
		# for grafana dashboard
	        add_header Access-Control-Allow-Origin "*";
	        add_header Access-Control-Allow-Methods "GET, OPTIONS";
	        add_header Access-Control-Allow-Headers "origin, authorization, accept";

		alias #PROJECT_ROOT#/static;
	}

	location /krylov {
		uwsgi_pass salt-dev-django-krylov;
		include uwsgi_params;
	}

	location / {
		uwsgi_pass salt-dev-django;
		include uwsgi_params;
	}

 	location /status {
		stub_status on;
 		access_log   off;
  		allow 217.174.98.237;
		allow 217.174.97.87;
		allow 172.16.0.0/16;
		allow 127.0.0.1;
  		deny all;
  	}

	location /ammo {
		alias /data/qa/ammo;
	}
}

server {
    listen 81;
	server_name salt-dev, salt-dev.dev.ix.km;
	charset     utf-8;

	client_max_body_size 75M;

	location /media  {
		alias #PROJECT_ROOT#/media;
	}

#	location /js  {
#		alias #PROJECT_ROOT#/js;
#	}

	location /static  {
		# for grafana dashboard
	        add_header Access-Control-Allow-Origin "*";
	        add_header Access-Control-Allow-Methods "GET, OPTIONS";
	        add_header Access-Control-Allow-Headers "origin, authorization, accept";

		alias #PROJECT_ROOT#/static;
	}

	location / {
		uwsgi_pass salt-dev-django-krylov;
		include uwsgi_params;
	}

}
